@model List<Entities.Category>

<div id="kt_app_content_container" class="app-container  container-xxl ">
    <!--begin::Main-->
    <div class="app-main flex-column flex-row-fluid " id="kt_app_main">
        <!--begin::Content wrapper-->
        <div class="d-flex flex-column flex-column-fluid">

            <!--begin::Toolbar-->
            <div id="kt_app_toolbar" class="app-toolbar  py-3 py-lg-6 ">

                <!--begin::Toolbar container-->
                <div id="kt_app_toolbar_container" class="app-container  container-xxl d-flex flex-stack ">


    <!--begin::Category-->
    <div class="card card-flush">
        <!--begin::Card header-->
        <div class="card-header align-items-center py-5 gap-2 gap-md-5">
            <!--begin::Card title-->
            <div class="card-title">
                <!--begin::Search-->
                <div class="d-flex align-items-center position-relative my-1">
                    <i class="ki-duotone ki-magnifier fs-3 position-absolute ms-4"><span class="path1"></span><span class="path2"></span></i>                <input type="text" data-kt-ecommerce-category-filter="search" class="form-control form-control-solid w-250px ps-12" placeholder="Search Category">
                </div>
                <!--end::Search-->
            </div>
            <!--end::Card title-->
            <!--begin::Card toolbar-->
            <div class="card-toolbar">
                <!--begin::Add customer-->

                <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#kt_modal_1">
                    Malzeme Ekle
                </button>

                <div class="modal fade" tabindex="-1" id="kt_modal_1">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h3 class="modal-title">Modal title</h3>

                                <!--begin::Close-->
                                <div class="btn btn-icon btn-sm btn-active-light-primary ms-2" data-bs-dismiss="modal" aria-label="Close">
                                    <i class="ki-duotone ki-cross fs-1"><span class="path1"></span><span class="path2"></span></i>
                                </div>
                                <!--end::Close-->
                            </div>

                            <div class="modal-body">
                           
                                <div class="form-group">
                                    <label for="recipient-name" class="col-form-label">Kategori adı:</label>
                                    <input type="text" class="form-control" placeholder="Girmek istediğiniz kategori adı:" id="Name">
                                </div>  
                                <div class="form-group">
                                    <label for="recipient-name" class="col-form-label">parent adı:</label>
                                    <input type="number" class="form-control" placeholder="Girmek istediğiniz parent id:" id="ParentCategoryId">
                                </div>
                                <div class="form-group">
                                    <label for="recipient-name" class="col-form-label">Status:</label>
                                    <input type="number" class="form-control" placeholder="aktiflik?" id="Status">
                                </div>

                             @*    <div class="mb-0">
                                    <label for="" class="form-label">Giriş Zamanı:</label>
                                    <input class="form-control form-control-solid" placeholder="Giriş Zamanı Seçiniz" id="EntryTime" />
                                </div>
                                <div class="form-group">
                                    <label for="" class="form-label">Çıkış Zamanı:</label>
                                    <input class="form-control form-control-solid" placeholder="Çıkış Zamanı Seçiniz" id="EndTime" />
                                </div>
 *@

                            </div>

                            <div class="modal-footer">
                                <button type="button" class="btn btn-light" data-bs-dismiss="modal">Close</button>
                                <button type="button" class="btn btn-primary" onclick="AddCategory()">Save changes</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!--end::Add customer-->
            </div>
            <!--end::Card toolbar-->
        </div>
        <!--end::Card header-->
        <!--begin::Card body-->
        <div class="card-body pt-0">

            <!--begin::Table-->
            <div id="kt_ecommerce_category_table_wrapper" class="dt-container dt-bootstrap5 dt-empty-footer">
                <div id="" class="table-responsive">
                    <table class="table align-middle table-row-dashed fs-6 gy-5 dataTable" id="kt_ecommerce_category_table" style="width: 1134.1px;">
                        
                        <colgroup><col data-dt-column="0" style="width: 36.4px;"><col data-dt-column="1" style="width: 764.362px;"><col data-dt-column="2" style="width: 199.213px;"><col data-dt-column="3" style="width: 134.125px;"></colgroup>
                                        <thead>
                                            <tr class="text-start text-gray-500 fw-bold fs-7 text-uppercase gs-0">
                                                <th style="    transform: translateX(15px);">#</th>
                                                <th style="transform:translateX(30px)"> Kategori Adı</th>
                                                <th>Mevcut mu?</th>
                                                <th>Düzenle</th>
                                            </tr>
                                        </thead>
                                        <tbody class="fw-semibold text-gray-600">
                                            @foreach (var item in Model)
                                            {
                                                <tr>

                                                    <td>
                                                        <div class="d-flex align-items-center">

                                                            <div class="ms-5">
                                                                <!--begin::Title-->
                                                                <a href="edit-category.html" class="text-gray-800 text-hover-primary fs-5 fw-bold" data-kt-ecommerce-product-filter="category_name">@item.Id</a>
                                                                <!--end::Title-->
                                                            </div>
                                                        </div>
                                                    </td>
                                                    <td class="text-left pe-0" style="transform:translateX(30px)">
                                                        <span class="fw-bold">@item.Name</span>
                                                    </td>
                                                    <td class="text-left pe-0" data-order="14" style="transform:translateX(30px)">
                                                        <span class="fw-bold ms-3">
                                                            @if (item.Status == 1)
                                                            {
                                                                @("Active")
                                                            }
                                                            else
                                                            {
                                                                @("Inactive")
                                                                
                                                            }
                                                        </span>
                                                    </td>


                                                    <td class="text-right">
                                                        <a href="#" onclick="openUpdateModal()" class="btn btn-sm btn-light btn-flex btn-center btn-active-light-primary" data-kt-menu-trigger="click" data-kt-menu-placement="bottom-end">
                                                            Düzenle
                                                            <i class="ki-duotone ki-down fs-5 ms-1"></i>
                                                        </a>
                                                        <!--begin::Menu-->
                                                        <div class="menu menu-sub menu-sub-dropdown menu-column menu-rounded menu-gray-600 menu-state-bg-light-primary fw-semibold fs-7 w-125px py-4" data-kt-menu="true">
                                                            <!--begin::Menu item-->
                                                            <div class="menu-item px-3">
                                                                <a href="#" class="menu-link px-3">
                                                                    Güncelle
                                                                </a>
                                                            </div>

                                                            <!--end::Menu item-->
                                                            <!--begin::Menu item-->
                                                            <div class="menu-item px-3">
                                                                <a href="#" onclick="DeleteCategory(@item.Id)" class="menu-link px-3" data-kt-ecommerce-product-filter="delete_row">
                                                                    Sil
                                                                </a>
                                                            </div>
                                                            <!--end::Menu item-->
                                                        </div>
                                                        <!--end::Menu-->
                                                    </td>
                                                </tr>
                                            }

                                        </tbody>
                        <!--end::Table body-->
                        <tfoot></tfoot>
                    </table>
                    <div id="" class="row">
                        <div id="" class="col-sm-12 col-md-5 d-flex align-items-center justify-content-center justify-content-md-start dt-toolbar">
                            <div>
                                <select name="kt_ecommerce_category_table_length" aria-controls="kt_ecommerce_category_table" class="form-select form-select-solid form-select-sm" id="dt-length-0">
                                    <option value="10">10</option>
                                    <option value="25">25</option>
                                    <option value="50">50</option>
                                    <option value="100">100</option>
                                </select>
                                <label for="dt-length-0"></label>
                            </div>
                        </div>
                        <div id="" class="col-sm-12 col-md-7 d-flex align-items-center justify-content-center justify-content-md-end">
                            <div class="dt-paging paging_simple_numbers">
                                <ul class="pagination">
                                    <li class="dt-paging-button page-item disabled">
                                        <a class="page-link previous" aria-controls="kt_ecommerce_category_table" aria-disabled="true" aria-label="Previous" data-dt-idx="previous" tabindex="-1">
                                            <i class="previous"></i>
                                        </a>
                                    </li>
                                    <li class="dt-paging-button page-item active">
                                        <a href="#" class="page-link" aria-controls="kt_ecommerce_category_table" aria-current="page" data-dt-idx="0" tabindex="0">1</a>
                                    </li>
                                    <li class="dt-paging-button page-item">
                                        <a href="#" class="page-link next" aria-controls="kt_ecommerce_category_table" aria-label="Next" data-dt-idx="next" tabindex="0">
                                            <i class="next"></i>
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
               
            <!--end::Table-->
        </div>
        <!--end::Card body-->
    </div>
    <!--end::Category-->
</div>
</div>
<!--end::Content container-->
        </div>
<!--end::Content-->
    </div>
<!--end::Content wrapper-->
</div>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="~/assets/plugins/global/plugins.bundle.js"></script>

   <script>

        // $(document).ready(function () {
        //     $("#EntryTime").flatpickr();
        //     $("#EndTime").flatpickr();
        // }); 
      
        
        function AddCategory() {

            var category = {
                Id: 0,
                Name: $('#Name').val().toString(),
                ParentCategoryId: parseInt($('#ParentCategoryId').val()),
                Status: parseInt($('#Status').val()),
                // EntryTime: $('#EntryTime').val(),
                // EndTime: $('#EndTime').val()
            };

            Swal.fire({
                title: 'Onaylıyor musunuz?',
                text: "Bu ürünü kaydetmek istediğinizden emin misiniz?",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'Evet, kaydet!',
                cancelButtonText: 'Hayır, iptal et!'
            }).then((result) => {
                if (result.isConfirmed) {

                    $.ajax({
                        url: '/Category/AddCategory',
                        type: 'POST',
                        contentType: 'application/json',
                        data: JSON.stringify(category),
                        success: function (response) {
                            if (response.success) {
                                Swal.fire(
                                    'Kaydedildi!',
                                    'Ürün başarıyla kaydedildi.',
                                    'success'
                                ).then(() => {
                                    // Reload the page or update the stock list
                                    location.reload(); // This will reload the entire page

                                    // Alternatively, you can just refresh the stock list part
                                    // $('#stockList').load('/Stock/StockList #stockList');

                                    // Clear the form if needed
                                    //$('#CategoryName').val('');
                                    
                                });
                            }
                            else {
                                Swal.fire(
                                    'Hata!',
                                    'Bir hata oluştu: ' + response.error,
                                    'error'
                                );
                            }
                        },
                        
                    });
                }
            });
        }

        function DeleteCategory(Id) {
            Swal.fire({
                title: 'Silmek istediğinize emin misiniz?',
                text: "Bu işlem geri alınamaz!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'Evet, sil!',
                cancelButtonText: 'Hayır, iptal et!'
            }).then((result) => {
                if (result.isConfirmed) {
                    $.ajax({
                        url: `/Category/DeleteCategory?Id=${Id}`, 
                        type: 'GET',
                        success: function (response) {
                            Swal.fire(
                                'Silindi!',
                                'Ürün başarıyla silindi.',
                                'success'
                            ).then(() => {
                                location.reload(); 

                                // Alternatively, you can handle the UI update manually
                                // For example, removing the item from a list or table
                            });
                        },
                        error: function (xhr) {
                            Swal.fire(
                                'Hata!',
                                'Bir hata oluştu: ',
                                'error'
                            );
                        }
                    });
                }
            });
        }


   </script>
